---
title: Mechanisms through which exercise reduces symptom severity and/or functional   impairment   in   posttraumatic
  stress disorder (PTSD)
author: "Simonne Wright, Virginia Chiocchia, Georgia Salanti <span style='font-size: 15px'></style>"
date: "`r format(Sys.Date(), '%e %b %Y')`"
output: 
 html_document:
   df_print: paged
   mainfont: Arialh
---

```{r  setup, error=FALSE, warning=FALSE, message=FALSE, include=FALSE}
#Load package 'meta' to run meta-analyses.
library(meta)
library(tidyr)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(Matrix)
library(knitr)
library(kableExtra)
library(rms) 
library(meta)
library(devtools)
library(tools)
library(metafor)
library(gtools)
library(metasens)
library(robvis)

setwd("C:/Users/simon/Desktop/Github rep/LSR2_exercise_H/")

load("data/data_2023-12-4_LSR2_Awks2.RData")
load("data/LSR2weeksStata2insufdata.RData")

load("data/LSR2_studychartab_wks_140124.RData")
load("data/LSR2_studychartab_insuf_140124.RData")

## prisma<-read.csv("data/LSR3_H_PRISMA_2024.01.23.csv") #csv file for the prisma2020 -->
## prisma<-PRISMA_data(prisma) 

#risk of bias data
rob<-read_xlsx("data/LSR2_robptsd_260124.xlsx")

#Round off results to two digits
settings.meta(digits = 2)

#update study names for Whitworth pilot and main studies
data_2023_12_4_LSR2_Awks2$study[data_2023_12_4_LSR2_Awks2$study == "Whitworth2018"] <- "Whitworth2019a"
data_2023_12_4_LSR2_Awks2$study[data_2023_12_4_LSR2_Awks2$study == "Whitworth2019"] <- "Whitworth2019b"

LSR2_studychartab_wks_140124$Study[LSR2_studychartab_wks_140124$Study == "Whitworth2018"] <- "Whitworth2019a"
LSR2_studychartab_wks_140124$Study[LSR2_studychartab_wks_140124$Study == "Whitworth2019"] <- "Whitworth2019b"

#add ROB variable "high" (no = low/some concerns; yes = high)
data_2023_12_4_LSR2_Awks2$high <- c("no", "yes" , "no" , "yes" , "no" , "yes" , "yes", "yes" , "yes")

#create subset for ROB sensitivity analysis: select studies with treatments "OLA" and "PLA"
data.rob.sens = subset(data_2023_12_4_LSR2_Awks2, high == "no")

```

# Results

## Flow of Study Selection and Descriptives

We identified *number of records* records. The PRISMA flow chart describing the inclusion process is presented in Figure 1. A total of `r length(table(data_2023_12_4_LSR2_Awks2$studyN))+length(table(LSR2weeksStata2insufdata$studyN))` studies with data from `r sum(data_2023_12_4_LSR2_Awks2$totNrandom, na.rm=T)+ sum(LSR2weeksStata2insufdata$totNrandom, na.rm=T)` participants were eligible for inclusion.

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` of the `r  length(table(data_2023_12_4_LSR2_Awks2$studyN)) + length(table(LSR2weeksStata2insufdata$studyN))` studies were included in the meta-analyses *references*. Meta-analysis was not feasible for `r length(table(LSR2weeksStata2insufdata$studyN))` studies *references*, which have been synthesized without an accompanying meta-analysis. 10 of the studies were RCTs, and 1 was a crossover RCT *reference*. Three of the studies provided follow-up PTSD outcome data which was insufficient for synthesis *reference*.

Study characteristics of the `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies included in the meta-analysis are summarized in Table 1. From these `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies, there were `r length(table(data_2023_12_4_LSR2_Awks2$study))` eligible comparisons. One study presented findings from two independent comparisons, including a total of four distinct intervention groups *reference*. One of the first authors published findings from two different but methodically similar trials in the same year *reference*.

```{r echo=FALSE}
knitr::kable(LSR2_studychartab_wks_140124[, 1:13], "pipe")
```

**Table 1:** Study characteristics of the `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies included in the meta-analysis.

Study characteristics of the `r length(table(LSR2weeksStata2insufdata$studyN))` studies not included in the meta-analysis are summarized in Table 2. From these `r length(table(LSR2weeksStata2insufdata$studyN))` studies, there were `r length(table(LSR2weeksStata2insufdata$study))` eligible comparisons.One study reported two comparisons *reference*.

```{r echo=FALSE}
knitr::kable(LSR2_studychartab_insuf_140124[, 1:10], "pipe")
```

**Table 2:** Study characteristics of the `r length(table(LSR2weeksStata2insufdata$studyN))` studies not included in the meta-analysis.

<!-- TO ADD: 

##PRISMA flowchart and tables listing included studies 

-->

## Risk of bias assessment

The results of the ROB assessment per domain and study for the primary outcome, PTSD symptom severity is presented below. Nine studies reported PTSD outcome data post-intervention. Two studies did not report PTSD outcome data (Crombie et al., 2021a; Greene & Petruzzello, 2022). 
Overall, five studies were rated as high, three studies as some concerns, and one was rated as low risk of bias. 
High risk of bias was mainly due to deviations from intended intervention (D2)(Voorendonk et al., 2023; Whitworth et al., 2019a; Whitworth et al., 2019b), missing outcome data (D3)(Rosenbaum et al., 2015; Voorendonk et al., 2023; Whitworth et al., 2019a; Whitworth et al., 2019b), and selection of reported results (D5)(Voorendonk et al., 2023; Young-McCaughan et al., 2022). The risk of bias assessment per domain and study is reported in Figure #

``` {r echo =F, fig.fullwidth=T, fig.width=8, fig.height=8}

rob_traffic_light(data = rob , tool = "ROB2")

```

**Figure #** Risk of bias for PTSD symptom severity 

## Research question I

### Meta-analysis of PTSD Symptom Severity (Primary Outcome)

For the studies included in the meta-analyses, the earliest studies were performed in `r format(min((data_2023_12_4_LSR2_Awks2$year)), format="%Y")`, while the most recent studies were performed in `r format(max((data_2023_12_4_LSR2_Awks2$year)), format="%Y")`. The median sample size across the studies was `r round(median(data_2023_12_4_LSR2_Awks2$totNrandom, na.rm=T))` participants per study. The median of the mean participant age was `r round(median((data_2023_12_4_LSR2_Awks2$AGEm), na.rm=T))` years (ranging from `r round(min((data_2023_12_4_LSR2_Awks2$AGEm),na.rm=T))` to `r round(max((data_2023_12_4_LSR2_Awks2$AGEm),na.rm=T))` years).

#### Post-intervention (weeks)

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies provided data for PTSD symptom severity and contributed `r length(data_2023_12_4_LSR2_Awks2$tg1PTSD3PTm)` effect measures to the PTSD symptom severity meta-analysis. The summary for PTSD symptom severity is shown in Figure 2.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
#SUMMARIZE the SMDs from studies using metacont & POOL the data 
LSR2mainMA = metacont(tg1PTSD3PTn , tg1PTSD3PTm ,tg1PTSD3PTsd ,tg2PTSD3PTn, tg2PTSD3PTm, tg2PTSD3PTsd ,
                      data = data_2023_12_4_LSR2_Awks2, studlab = study, sm = "SMD")

forest(LSR2mainMA, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 2:** Meta-analysis of the effects of exercise on PTSD symptom severity.

The meta-analysis found no significant difference in PTSD symptom severity between exercise and comparison groups, `r paste(LSR2mainMA$sm, "=", round(LSR2mainMA$TE.random, 2),", (95% CI", round(LSR2mainMA$lower.random, 2), "to", round(LSR2mainMA$upper.random, 2))`).

Low heterogeneity was found as suggested by the prediction interval which is only slightly wider than the confidence interval.

#### Subgroup Analyses and Meta-regressions 

We explore whether heterogeneity could be potentially explained by differences in study-level characteristics using subgroup analyses and meta-regression  below. The following characteristics were explored as sources of heterogeneity for the primary outcome, PTSD symptom severity:

-   Exercise intensity (moderate intensity vs high intensity)

-   Specific exercise type (aerobic vs. anaerobic vs. mixed)

-   Exercise augmented by TAU/therapy (exercise only vs. therapy/tau)

-   Intervention length (weeks) 

#### Subgroup analysis by exercise intensity

There was no significant difference in PTSD symptom severity between studies with moderate intensity and those with high intensity exercise groups (see Figure 3). However, visual inspection of the forest plot suggests the effect is larger for the high intensity exercise subgroup.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
subgroup.intensity = update(LSR2mainMA, subgroup = intensityEX2) 

# produce a forest plot
forest(subgroup.intensity, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 3:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise intensity

#### Subgroup analysis by specific exercise type

There was no significant difference in PTSD symptom severity between studies with aerobic or anaerobic or mixed exercise groups (see Figure 4).

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.tg1specEX  
subgroup.tg1specEX = update(LSR2mainMA, subgroup = tg1specEX2) 

# produce a forest plot 
forest(subgroup.tg1specEX, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 4:** Sub-group analysis of the effects of exercise on PTSD symptom severity by specific exercise type

#### Subgroup analysis by exercise alone or tau/therapy augmented by exercise

There was no significant difference in PTSD symptom severity between studies with exercise alone or tau/therapy augmented by exercise (see Figure 5). However, visual inspection of the forest plot suggests the effect is larger for exercise alone compared with an inactive comparison group than for the studies that augmented psychotherapy and TAU with exercise.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.EXEaug  
subgroup.EXEaug = update(LSR2mainMA, subgroup = EXEaug2) 

# produce a forest plot using the JAMA layout.
forest(subgroup.EXEaug, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 5:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise alone or tau/therapy augmented by exercise

#### Meta-regression by intervention length 
 
```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4} 

# Do a meta-regression with the continuous covariate intervLENGTH (lenth of intervention - weeks) 

 intervLENGTHreg = metareg(LSR2mainMA, intervLENGTH) 

```
 
 <!-- # not sure if this is right:  the 'beta coef' becausae intervLENGTHreg$beta didnt work-->
Overall, there is no evidence that the intervention length affected the treatment effect. The meta-regression analysis yielded a beta coefficient of `r intervLENGTHreg$QMp` with a 95% CI ranging from `r round(intervLENGTHreg$ci.lb, 2)` to `r round(intervLENGTHreg$ci.ub, 2)`

 
```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4} 

# generate a bubble plot. 

bubble(intervLENGTHreg, col.line = "blue") 

```
 **Figure 6:** Meta-regression of the effects of exercise on PTSD symptom severity by intervention length 
 

### Meta-analysis of Treatment Dropout (secondary outcome)

#### Post-intervention (weeks)

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies provided data for treatment dropout, and contributed `r length(data_2023_12_4_LSR2_Awks2$tg1Ndrop)` effect measures to the treatment dropout meta-analysis. The summary for the risk of dropping out of treatment dropout between the intervention and comparison groups is shown in Figure 7.

```{r echo=F, fig.fullwidth=T, fig.width=11, fig.height=4}
#Summarize the study-specific risk ratios for study completors from studies using metabin
#create an object of class meta called “pooledRRdrop”
pooledRRdrop = metabin(tg1Ndrop, tg1Nrandom,	tg2Ndrop,tg2Nrandom,
                       data = data_2023_12_4_LSR2_Awks2, studlab = study, sm = "RR")

#obtain the forest plot 
forest(pooledRRdrop, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 7:** Meta-analysis of the dropout rates between the intervention and control groups

The meta-analysis found no evidence of a difference in treatment dropout between exercise and comparison groups, `r paste(pooledRRdrop$sm, "=" , round(pooledRRdrop$TE.random, 2), "(95% CI ", round(pooledRRdrop$lower.random, 2), "to", round(pooledRRdrop$upper.random, 2))`) and there is large heterogeneity, as shown by the prediction interval (`r paste(round(exp(pooledRRdrop$lower.predict),2), "to",round(exp(pooledRRdrop$upper.predict),2))`).

### Sensitivity Analyses

We examine the robustness of the findings for the primary outcome by excluding studies with high risk of bias.`r length(table(data.rob.sens$study))` studies were rated as low or some concerns 

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
#SUMMARIZE the SMDs from studies using metacont & POOL the data 
rob.sens.MA = metacont(tg1PTSD3PTn , tg1PTSD3PTm ,tg1PTSD3PTsd ,tg2PTSD3PTn, tg2PTSD3PTm, tg2PTSD3PTsd ,
                      data = data.rob.sens, studlab = study, sm = "SMD")

forest(rob.sens.MA, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```
 **Figure 8:** Meta-analysis of the effects of exercise on PTSD symptom severity when excluding studies with high risk of bias 

The meta-analysis found no significant difference in PTSD symptom severity between exercise and comparison groups, `r paste(rob.sens.MA$sm, "=", round(rob.sens.MA$TE.random, 2),", (95% CI", round(rob.sens.MA$lower.random, 2), "to", round(rob.sens.MA$upper.random, 2))`).

<!-- not sure how to comment on this heterogeneity because I squared is 0% (I cant comment on this from a frequentist approach. The 95%CI is really large but this is just because 1 of the 3 studies has a really wide CI. I think the actually issue is actually running a MA on three studies -->


*********

OR 

We examine the robustness of the findings by comparing the effects of risk of bias on the primary outcome, PTSD symptom severity.`r length(table(data.rob.sens$study))` studies were rated as low or some concerns.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
# create a new R object subgroup.EXEaug  
subgroup.rob = update(LSR2mainMA, subgroup = high) 

# produce a forest plot using the JAMA layout.
forest(subgroup.rob, 
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```
 **Figure 8:** Sub-group analysis of the effects of exercise on PTSD symptom severity by risk of bias rating.

There was no significant difference in PTSD symptom severity between studies rated as low or some concerns compared to those rated with a high risk of bias  (see Figure 8).

*********

### Reporting bias

The forest plot below show the meta-analysis results of the primary outcome ordered by precision of the studies (i.e. standard error of the effects). It seems that the smaller studies showed larger effects favouring the intervention.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
# forest polot ordered by precision

forest(LSR2mainMA, 
       sortvar = seTE,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

## Summary of the evidence on the primary outcome from the human studies

The primary outcome was efficacy in reducing overall PTSD symptom severity in patients with PTSD. The summary of the evidence on PTSD symptom severity outcome for PTSD is reported below.

|                          |                                  |                                   |                                |                                  |                               |
|------------|------------|------------|------------|------------|------------|
| **Source of evidence**   | **Summary of the association**   | **Bias due to study limitations** | **Bias due to reporting bias** | **Bias due to indirectedness**   | **Bias due to other reasons** |
|                          |                                  |                                   |                                |                                  |                               |
