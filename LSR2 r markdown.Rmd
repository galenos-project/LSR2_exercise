---
title: Mechanisms through which exercise reduces symptom severity and/or functional   impairment   in   posttraumatic
  stress disorder (PTSD)
author: "Simonne Wright"
date: "2024-01-08"
output: html_document
---

```{r  setup, error=FALSE, warning=FALSE, message=FALSE, include=FALSE}
#Load package 'meta' to run meta-analyses.
library(meta)
library(tidyr)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(Matrix)
library(knitr)
library(kableExtra)
library(rms) 
library(meta)
library(devtools)
library(tools)
library(metafor)
library(gtools)
library(metasens)


load("data/data_2023-12-4_LSR2_Awks2.RData")
load("data/LSR2weeksStata2insufdata.RData")

load("data/LSR2_studychartab_wks_140124.RData")
load("data/LSR2_studychartab_insuf_140124.RData")

#Round off results to two digits
settings.meta(digits = 2)

#update study names for Whitworth pilot and main studies
data_2023_12_4_LSR2_Awks2$study[data_2023_12_4_LSR2_Awks2$study == "Whitworth2018"] <- "Whitworth2019a"
data_2023_12_4_LSR2_Awks2$study[data_2023_12_4_LSR2_Awks2$study == "Whitworth2019"] <- "Whitworth2019b"

LSR2_studychartab_wks_140124$Study[LSR2_studychartab_wks_140124$Study == "Whitworth2018"] <- "Whitworth2019a"
LSR2_studychartab_wks_140124$Study[LSR2_studychartab_wks_140124$Study == "Whitworth2019"] <- "Whitworth2019b"
```

# Results

## Flow of Study Selection and Descriptives

We identified *number of records* records. The PRISMA flow chart describing the inclusion process is presented in Figure 1. A total of `r length(table(data_2023_12_4_LSR2_Awks2$studyN))+length(table(LSR2weeksStata2insufdata$studyN))` studies with data from `r sum(data_2023_12_4_LSR2_Awks2$totNrandom, na.rm=T)+ sum(LSR2weeksStata2insufdata$totNrandom, na.rm=T)` participants were eligible for inclusion.

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` of the `r  length(table(data_2023_12_4_LSR2_Awks2$studyN)) + length(table(LSR2weeksStata2insufdata$studyN))` studies were included in the meta-analyses *references*. Meta-analysis was not feasible for `r length(table(LSR2weeksStata2insufdata$studyN))` studies *references*, which have been synthesized without an accompanying meta-analysis. 10 of the studies were RCTs, and 1 was a crossover RCT *reference*

Study characteristics of the `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies included in the meta-analysis are summarized in Table 1. From these `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies, there were `r length(table(data_2023_12_4_LSR2_Awks2$study))` eligible comparisons. One study reported two independent comparisons *reference*.

```{r echo=FALSE}
knitr::kable(LSR2_studychartab_wks_140124[, 1:13], "pipe")
```

**Table 1:** Study characteristics of the `r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies included in the meta-analysis.

<!--# it's 9 studies in the table above, not 8 - if some provide more effect sizes make it clearer in the table and make sure details are correct; at the moment it looks like 9 different studies -->

Study characteristics of the `r length(table(LSR2weeksStata2insufdata$studyN))` studies not included in the meta-analysis are summarized in Table 2. From these `r length(table(LSR2weeksStata2insufdata$studyN))` studies, there were `r length(table(LSR2weeksStata2insufdata$study))` eligible comparisons.One study reported two comparisons *reference*.

```{r echo=FALSE}
knitr::kable(LSR2_studychartab_insuf_140124[, 1:10], "pipe")
```

**Table 2:** Study characteristics of the `r length(table(LSR2weeksStata2insufdata$studyN))` studies not included in the meta-analysis.

<!--# TO ADD: PRISMA flowchart and tables listing included studies -->

## Research question I

### Meta-analysis of PTSD Symptom Severity (Primary Outcome)

For the studies included in the meta-analyses, the earliest studies were performed in `r format(min((data_2023_12_4_LSR2_Awks2$year)), format="%Y")`, while the most recent studies were performed in `r format(max((data_2023_12_4_LSR2_Awks2$year)), format="%Y")`. The median sample size across the studies was `r round(median(data_2023_12_4_LSR2_Awks2$totNrandom, na.rm=T))` participants per study. The median of the mean participant age was `r round(median((data_2023_12_4_LSR2_Awks2$AGEm), na.rm=T))` years (ranging from `r round(min((data_2023_12_4_LSR2_Awks2$AGEm),na.rm=T))` to `r round(max((data_2023_12_4_LSR2_Awks2$AGEm),na.rm=T))` years).

#### Post-intervention (weeks)

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies provided data for PTSD symptom severity and contributed `r length(data_2023_12_4_LSR2_Awks2$tg1PTSD3PTm)` effect measures to the PTSD symptom severity meta-analysis. The summary for PTSD symptom severity is shown in Figure 2.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
#SUMMARIZE the SMDs from studies using metacont & POOL the data 
LSR2mainMA = metacont(tg1PTSD3PTn , tg1PTSD3PTm ,tg1PTSD3PTsd ,tg2PTSD3PTn, tg2PTSD3PTm, tg2PTSD3PTsd ,
                      data = data_2023_12_4_LSR2_Awks2, studlab = study, sm = "SMD")

forest(LSR2mainMA, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 2:** Meta-analysis of the effects of exercise on PTSD symptom severity.

The meta-analysis found no significant difference in PTSD symptom severity between exercise and comparison groups, `r paste(LSR2mainMA$sm, "=", round(LSR2mainMA$TE.random, 2),", (95% CI", round(LSR2mainMA$lower.random, 2), "to", round(LSR2mainMA$upper.random, 2))`).

Low heterogeneity was found as suggested by the prediction interval which is only slightly wider than the confidence interval.

#### Subgroup Analyses

<!-- and Meta-regressions -->

We explore whether heterogeneity could be potentially explained by differences in study-level characteristics using subgroup analyses <!-- and meta-regression --> below. The following characteristics were explored as sources of heterogeneity for the primary outcome, PTSD symptom severity:

-   Exercise intensity (moderate intensity vs high intensity)

-   Specific exercise type (aerobic vs. anaerobic vs. mixed)

-   Exercise augmented by TAU/therapy (exercise only vs. therapy/tau)

<!-- -   Intervention length (weeks) -->

#### Subgroup analysis by exercise intensity

There was no significant difference in PTSD symptom severity between studies with moderate intensity and those with high intensity exercise groups (see Figure 3). However, visual inspection of the forest plot suggests the effect is larger for the high intensity exercise subgroup.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
subgroup.intensity = update(LSR2mainMA, subgroup = intensityEX2) 

# produce a forest plot
forest(subgroup.intensity, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 3:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise intensity

#### Subgroup analysis by specific exercise type

There was no significant difference in PTSD symptom severity between studies with aerobic or anaerobic or mixed exercise groups (see Figure 4).

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.tg1specEX  
subgroup.tg1specEX = update(LSR2mainMA, subgroup = tg1specEX2) 

# produce a forest plot 
forest(subgroup.tg1specEX, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 4:** Sub-group analysis of the effects of exercise on PTSD symptom severity by specific exercise type

#### Subgroup analysis by exercise alone or tau/therapy augmented by exercise

There was no significant difference in PTSD symptom severity between studies with exercise alone or tau/therapy augmented by exercise (see Figure 5). However, visual inspection of the forest plot suggests the effect is larger for exercise alone compared with an inactive comparison group than for the studies that augmented psychotherapy and TAU with exercise.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.EXEaug  
subgroup.EXEaug = update(LSR2mainMA, subgroup = EXEaug2) 

# produce a forest plot using the JAMA layout.
forest(subgroup.EXEaug, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 5:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise alone or tau/therapy augmented by exercise

<!--# subgroup analysis and meta-regression are essentially the same thing so if you did the subgroup analyses I would also do meta-regressions -->

<!-- ####Meta-regression by intervention length -->

<!-- Overall, there is no evidence that the intervention length affected the treatment effect -->

<!-- # add value of beta with confidence interval -->

<!-- ```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4} -->

<!-- # Do a meta-regression with the continuous covariate intervLENGTH (lenth of intervention - weeks) -->

<!-- intervLENGTHreg = metareg(LSR2mainMA, intervLENGTH) -->

<!-- # generate a bubble plot. -->

<!-- bubble(intervLENGTHreg, col.line = "blue") -->

<!-- ``` -->

<!-- **Figure 6:** Meta-regression of the effects of exercise on PTSD symptom severity by intervention length -->

### Meta-analysis of Treatment Dropout (secondary outcome)

#### Post-intervention (weeks)

`r length(table(data_2023_12_4_LSR2_Awks2$studyN))` studies provided data for treatment dropout, and contributed `r length(data_2023_12_4_LSR2_Awks2$tg1Ndrop)` effect measures to the treatment dropout meta-analysis. The summary for the risk of dropping out of treatment dropout between the intervention and comparison groups is shown in Figure 7.

```{r echo=F, fig.fullwidth=T, fig.width=11, fig.height=4}
#Summarize the study-specific risk ratios for study completors from studies using metabin
#create an object of class meta called “pooledRRdrop”
pooledRRdrop = metabin(tg1Ndrop, tg1Nrandom,	tg2Ndrop,tg2Nrandom,
                       data = data_2023_12_4_LSR2_Awks2, studlab = study, sm = "RR")

#obtain the forest plot 
forest(pooledRRdrop, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 7:** Meta-analysis of the dropout rates between the intervention and control groups

The meta-analysis found no evidence of a difference in treatment dropout between exercise and comparison groups, `r paste(pooledRRdrop$sm, "=" , round(pooledRRdrop$TE.random, 2), "(95% CI ", round(pooledRRdrop$lower.random, 2), "to", round(pooledRRdrop$upper.random, 2))`) and there is large heterogeneity, as shown by the prediction interval (`r paste(round(exp(pooledRRdrop$lower.predict),2), "to",round(exp(pooledRRdrop$upper.predict),2))`).

### Sensitivity Analyses

We examine the robustness of the findings for the primary outcome by restricting the analysis to studies with low risk of bias.

<!--# where is this? -->

### Reporting bias

The forest plot below show the meta-analysis results of the primary outcome ordered by precision of the studies (i.e. standard error of the effects). It seems that the smaller studies showed larger effects favouring the intervention.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
# forest polot ordered by precision

forest(LSR2mainMA, 
       sortvar = seTE,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "Intervention", "Comparison"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

## Summary of the evidence on the primary outcome from the human studies

The primary outcome was efficacy in reducing overall PTSD symptom severity in patients with PTSD. The summary of the evidence on PTSD symptom severity outcome for PTSD is reported below.

|                          |                                  |                                   |                                |                                  |                               |
|------------|------------|------------|------------|------------|------------|
| **Source of evidence**   | **Summary of the association**   | **Bias due to study limitations** | **Bias due to reporting bias** | **Bias due to indirectedness**   | **Bias due to other reasons** |
|                          |                                  |                                   |                                |                                  |                               |
