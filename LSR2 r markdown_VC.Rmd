---
title: Mechanisms through which exercise reduces symptom severity and/or functional   impairment   in   posttraumatic
  stress disorder (PTSD)
author: "Simonne Wright"
date: "2023-12-07"
output: html_document
---

```{r  setup, error=FALSE, warning=FALSE, message=FALSE, include=FALSE}
#Load package 'meta' to run meta-analyses.
library(meta)
library(tidyr)
library(tibble)
library(stringr)
library(readxl)
library(grid)
library(dplyr)
library(Matrix)
library(knitr)
library(kableExtra)
library(rms) 
library(meta)
library(devtools)
library(tools)
library(metafor)
library(gtools)
library(metasens)

#loads datsets
load("data_2023-12-4_LSR2_Awks")
load("data_2023-12-4_LSR2_A_insufdata")

#Round off results to two digits
settings.meta(digits = 2)
```

# Results

## Flow of Study Selection and Descriptives

We identified *number of records* records. The PRISMA flow chart describing the inclusion process is presented in Figure 1. A total of `r length(table(LSR2weeksStata2$study))+length(table(LSR2weeksStata2insufdata$study))` studies with data from `r sum(LSR2weeksStata2$totNrandom, na.rm=T)+ sum(LSR2weeksStata2insufdata$totNrandom, na.rm=T)` participants were eligible for inclusion.

`r length(table(LSR2weeksStata2$study))` of the `r length(table(LSR2weeksStata2$study))+length(table(LSR2weeksStata2insufdata$study))` studies were included in the meta-analyses *references*. Meta-analysis was not feasible for `r length(table(LSR2weeksStata2insufdata$study))` studies *references*, which have been synthesized without an accompanying meta-analysis. 10 of the studies were RCTs and 1 was a crossover RCT *reference*

```{=html}
<!-- it's 12 studies, not 11 (change studyN to study in the codes above)
     maybe state why meta-analysis was not feasible for the 4 studies -->
```
Selected study characteristics of the `r length(table(LSR2weeksStata2$study))+length(table(LSR2weeksStata2insufdata$study))` included studies are summarized in Table 1.

For the studies included in the meta-analyses, the earliest studies were performed in `r format(min((LSR2weeksStata2$year)), format="%Y")`, while the most recent studies were performed in `r format(max((LSR2weeksStata2$year)), format="%Y")`. The median sample size across the studies was `r round(median(LSR2weeksStata2$totNrandom, na.rm=T))` participants per study. The median of the mean participant age was `r round(median((LSR2weeksStata2$AGEm), na.rm=T))` years (ranging from `r round(min((LSR2weeksStata2$AGEm),na.rm=T))` to `r round(max((LSR2weeksStata2$AGEm),na.rm=T))` years).

## Meta-analysis of PTSD Symptom Severity (Primary Outcome)

### Post-intervention (weeks)

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
#SUMMARIZE the SMDs from studies using metacont & POOL the data 
LSR2mainMA = metacont(tg1PTSD3PTn , tg1PTSD3PTm ,tg1PTSD3PTsd ,tg2PTSD3PTn, tg2PTSD3PTm, tg2PTSD3PTsd ,
                      data = LSR2weeksStata2, studlab = study, sm = "SMD")
```

`r length(table(LSR2weeksStata2$tg1PTSD3PTm))` studies provided data for PTSD symptom severity and contributed `r length(LSR2weeksStata2$tg1PTSD3PTm)` effect measures to the PTSD symptom severity meta-analysis. The summary for PTSD symptom severity is shown in Figure 2. The meta-analysis found no significant difference in PTSD symptom severity between exercise and comparison groups, `r paste(LSR2mainMA$sm, "=", round(LSR2mainMA$TE.random, 2), ", 95% CI (", round(LSR2mainMA$lower.random, 2), ",", round(LSR2mainMA$upper.random, 2), ")")`. Although the I^2^ value (0%) suggests there was no heterogeneity, some heterogeneity can be seen when inspecting the width of the prediction intervals.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
forest(LSR2mainMA, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "treat1s", "treat2s"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 2:** Meta-analysis of the effects of exercise on PTSD symptom severity.

## Subgroup Analyses and Meta-regressions

We explore whether heterogeneity could be potentially explained by differences in study-level characteristics using subgroup analyses and meta-regression below.T he following characteristics were explored as sources of heterogeneity for the primary outcome, PTSD symptom severity:

-   Exercise intensity (moderate intensity vs high intensity)

-   Specific exercise type (aerobic vs. anaerobic vs. mixed)

-   Exercise augmented by TAU/therapy (exercise only vs. therapy/tau)

-   Intervention length (weeks)

### Subgroup analysis by exercise intensity

There was no significant difference in PTSD symptom severity between studies with moderate intensity and those with high intensity exercise groups (p = .067; see Figure 3).

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
subgroup.intensity = update(LSR2mainMA, subgroup = intensityEX2) 
# produce a forest plot
forest(subgroup.intensity, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "treat1s", "treat2s"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 3:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise intensity

### Subgroup analysis by specific exercise type

There was no significant difference in PTSD symptom severity between studies with aerobic or anaerobic or mixed exercise groups (p = .191; see Figure 4).

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.tg1specEX  
subgroup.tg1specEX = update(LSR2mainMA, subgroup = tg1specEX2) 

# produce a forest plot 
forest(subgroup.tg1specEX, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "treat1s", "treat2s"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 4:** Sub-group analysis of the effects of exercise on PTSD symptom severity by specific exercise type

### Subgroup analysis by exercise alone or tau/therapy augmented by exercise

There was no significant difference in PTSD symptom severity between studies with exercise alone or tau/therapy augmented by exercise (p = .122; see Figure 5).

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=6}
# create a new R object subgroup.EXEaug  
subgroup.EXEaug = update(LSR2mainMA, subgroup = EXEaug2) 

# produce a forest plot using the JAMA layout.
forest(subgroup.EXEaug, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "treat1s", "treat2s"),
       rightcols = c( "effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 5:** Sub-group analysis of the effects of exercise on PTSD symptom severity by exercise alone or tau/therapy augmented by exercise

### Meta-regression by intervention length

Overall, the influence of intervention length on the treatment effect did not reach statistical significance intervention length (p = .136; see Figure 6)

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=4}
# Do a meta-regression with the continuous covariate intervLENGTH (lenth of intervention - weeks)
intervLENGTHreg = metareg(LSR2mainMA, intervLENGTH)

#generate a bubble plot.
bubble(intervLENGTHreg, col.line = "blue")
```

**Figure 6:** Meta-regression of the effects of exercise on PTSD symptom severity by intervention length

## Meta-analysis of Treatment Dropout (secondary outcome)

### Post-intervention (weeks)

`r length(table(LSR2weeksStata2$studyN))` studies provided data for treatment dropout, and contributed `r length(LSR2weeksStata2$tg1Ndrop)` effect measures to the PTSD symptom severity meta-analysis. The summary for PTSD symptom severity is shown in Figure 7. The meta-analysis found no significant difference in treatment dropout between exercise and comparison groups, RR = 1.30, 95% CI [0.61; 2.78], p = .496. Heterogeneity was high (I2 = 79%).

```{r echo=F, fig.fullwidth=T, fig.width=11, fig.height=4}
#Summarize the study-specific risk ratios for study completors from studies using metabin
#create an object of class meta called “pooledRRdrop”
pooledRRdrop = metabin(tg1Ndrop, tg1Nrandom,	tg2Ndrop,tg2Nrandom,
                       data = LSR2weeksStata2, studlab = study, sm = "RR")
#obtain the forest plot 
forest(pooledRRdrop, 
       sortvar = EXEaug,
       common = FALSE,
       print.I2.ci = T, 
       prediction=T,
       label.left = 'Favours intervention',
       label.right = "Favours control",
       leftcols = c("study", "treat1s", "treat2s"),
       rightcols = c("effect", "ci"),
       fs.study = 10, ff.study = "italic",
       col.diamond = "blue", col.diamond.lines = "black",
       col.square = "turquoise", col.square.lines = "black")
```

**Figure 7:** Meta-analysis of the effects of exercise on treatment dropout

## Sensitivity Analyses

We examine the robustness of the findings for the primary outcome by performing the following sensitivity analyses:

-   Restricting the analysis to studies with low risk of bias

## Reporting Bias

<!-- too few studies for funnel plot (<10) -->

Visual inspection of the funnel plot of standard error Hedges' g suggested possible publication bias in favour the of exercise group (n = 8). There was insufficient studies to test for small study effect.

```{r echo=FALSE, fig.fullwidth=T, fig.width=11, fig.height=3}
 #Produce a funnel plot 
funnel(LSR2mainMA, pch = 16,
       contour = c(0.9, 0.95, 0.99),
       col.contour = c("green", "yellow", "pink")) 

legend(0.25, 1.25,
       c("0.1 > p > 0.05", "0.05 > p > 0.01", "< 0.01"),
       fill = c("green", "yellow", "pink"), bty = "n")
```

**Figure 8:** Funnel plot of all studies included in the meta-analyses

## Summary of the Evidence
